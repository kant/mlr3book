<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6.6 Cost-Sensitive Classification | mlr3 manual</title>
  <meta name="description" content="6.6 Cost-Sensitive Classification | mlr3 manual" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="6.6 Cost-Sensitive Classification | mlr3 manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://mlr3book.mlr-org.com" />
  
  
  <meta name="github-repo" content="mlr-org/mlr3book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6.6 Cost-Sensitive Classification | mlr3 manual" />
  
  
  

<meta name="author" content="The mlr-org Team" />


<meta name="date" content="2019-07-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="multilabel.html">
<link rel="next" href="model-interpr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.7/visNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">mlr3 Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> mlr3 Basics</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="tasks-learners.html"><a href="tasks-learners.html"><i class="fa fa-check"></i><b>2.2</b> Tasks &amp; Learners</a></li>
<li class="chapter" data-level="2.3" data-path="tasks.html"><a href="tasks.html"><i class="fa fa-check"></i><b>2.3</b> Tasks</a><ul>
<li class="chapter" data-level="2.3.1" data-path="tasks.html"><a href="tasks.html#task-types"><i class="fa fa-check"></i><b>2.3.1</b> Task Types</a></li>
<li class="chapter" data-level="2.3.2" data-path="tasks.html"><a href="tasks.html#task-creation"><i class="fa fa-check"></i><b>2.3.2</b> Task Creation</a></li>
<li class="chapter" data-level="2.3.3" data-path="tasks.html"><a href="tasks.html#predefined-tasks"><i class="fa fa-check"></i><b>2.3.3</b> Predefined tasks</a></li>
<li class="chapter" data-level="2.3.4" data-path="tasks.html"><a href="tasks.html#task-api"><i class="fa fa-check"></i><b>2.3.4</b> Task API</a><ul>
<li class="chapter" data-level="2.3.4.1" data-path="tasks.html"><a href="tasks.html#retrieve-data"><i class="fa fa-check"></i><b>2.3.4.1</b> Retrieve Data</a></li>
<li class="chapter" data-level="2.3.4.2" data-path="tasks.html"><a href="tasks.html#roles-rows-and-columns"><i class="fa fa-check"></i><b>2.3.4.2</b> Roles (Rows and Columns)</a></li>
<li class="chapter" data-level="2.3.4.3" data-path="tasks.html"><a href="tasks.html#task-mutators"><i class="fa fa-check"></i><b>2.3.4.3</b> Task Mutators</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="learners.html"><a href="learners.html"><i class="fa fa-check"></i><b>2.4</b> Learners</a><ul>
<li class="chapter" data-level="2.4.1" data-path="learners.html"><a href="learners.html#predefined-learners"><i class="fa fa-check"></i><b>2.4.1</b> Predefined Learners</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="train-predict.html"><a href="train-predict.html"><i class="fa fa-check"></i><b>2.5</b> Train &amp; Predict</a><ul>
<li class="chapter" data-level="2.5.1" data-path="train-predict.html"><a href="train-predict.html#basic-concept"><i class="fa fa-check"></i><b>2.5.1</b> Basic concept</a><ul>
<li class="chapter" data-level="2.5.1.1" data-path="train-predict.html"><a href="train-predict.html#creating-task-and-learner-objects"><i class="fa fa-check"></i><b>2.5.1.1</b> Creating Task and Learner Objects</a></li>
<li class="chapter" data-level="2.5.1.2" data-path="train-predict.html"><a href="train-predict.html#setting-up-the-traintest-splits-of-the-data-split-data"><i class="fa fa-check"></i><b>2.5.1.2</b> Setting up the train/test splits of the data (#split-data)</a></li>
<li class="chapter" data-level="2.5.1.3" data-path="train-predict.html"><a href="train-predict.html#training-the-learner"><i class="fa fa-check"></i><b>2.5.1.3</b> Training the learner</a></li>
<li class="chapter" data-level="2.5.1.4" data-path="train-predict.html"><a href="train-predict.html#predicting"><i class="fa fa-check"></i><b>2.5.1.4</b> Predicting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>2.6</b> Resampling</a><ul>
<li class="chapter" data-level="2.6.1" data-path="resampling.html"><a href="resampling.html#resamp-settings"><i class="fa fa-check"></i><b>2.6.1</b> Settings</a></li>
<li class="chapter" data-level="2.6.2" data-path="resampling.html"><a href="resampling.html#resamp-inst"><i class="fa fa-check"></i><b>2.6.2</b> Instantiation</a></li>
<li class="chapter" data-level="2.6.3" data-path="resampling.html"><a href="resampling.html#resamp-exec"><i class="fa fa-check"></i><b>2.6.3</b> Execution</a></li>
<li class="chapter" data-level="2.6.4" data-path="resampling.html"><a href="resampling.html#custom-resampling"><i class="fa fa-check"></i><b>2.6.4</b> Custom resampling</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="benchmarking.html"><a href="benchmarking.html"><i class="fa fa-check"></i><b>2.7</b> Benchmarking</a><ul>
<li class="chapter" data-level="2.7.1" data-path="benchmarking.html"><a href="benchmarking.html#bm-design"><i class="fa fa-check"></i><b>2.7.1</b> Design Creation</a></li>
<li class="chapter" data-level="2.7.2" data-path="benchmarking.html"><a href="benchmarking.html#bm-exec"><i class="fa fa-check"></i><b>2.7.2</b> Execution and Aggregation of Results</a></li>
<li class="chapter" data-level="2.7.3" data-path="benchmarking.html"><a href="benchmarking.html#converting-specific-benchmark-objects-to-resample-objects"><i class="fa fa-check"></i><b>2.7.3</b> Converting specific benchmark objects to resample objects</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="binary.html"><a href="binary.html"><i class="fa fa-check"></i><b>2.8</b> Binary classification</a><ul>
<li class="chapter" data-level="2.8.1" data-path="binary.html"><a href="binary.html#roc"><i class="fa fa-check"></i><b>2.8.1</b> ROC</a></li>
<li class="chapter" data-level="2.8.2" data-path="binary.html"><a href="binary.html#thresholds"><i class="fa fa-check"></i><b>2.8.2</b> Thresholds</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="mlr-mlr3-transition-guide.html"><a href="mlr-mlr3-transition-guide.html"><i class="fa fa-check"></i><b>2.9</b> <code>mlr</code> -&gt; <code>mlr3</code> Transition Guide</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-optim.html"><a href="model-optim.html"><i class="fa fa-check"></i><b>3</b> Model Optimization</a><ul>
<li class="chapter" data-level="3.1" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>3.1</b> Hyperparameter Tuning</a><ul>
<li class="chapter" data-level="3.1.1" data-path="tuning.html"><a href="tuning.html#the-performance-evaluator-class"><i class="fa fa-check"></i><b>3.1.1</b> The <code>Performance Evaluator</code> class</a></li>
<li class="chapter" data-level="3.1.2" data-path="tuning.html"><a href="tuning.html#tuning-spaces"><i class="fa fa-check"></i><b>3.1.2</b> Tuning Hyperparameter Spaces</a></li>
<li class="chapter" data-level="3.1.3" data-path="tuning.html"><a href="tuning.html#defining-the-terminator"><i class="fa fa-check"></i><b>3.1.3</b> Defining the Terminator</a></li>
<li class="chapter" data-level="3.1.4" data-path="tuning.html"><a href="tuning.html#executing-the-tuning"><i class="fa fa-check"></i><b>3.1.4</b> Executing the Tuning</a></li>
<li class="chapter" data-level="3.1.5" data-path="tuning.html"><a href="tuning.html#inspecting-results"><i class="fa fa-check"></i><b>3.1.5</b> Inspecting Results</a></li>
<li class="chapter" data-level="3.1.6" data-path="tuning.html"><a href="tuning.html#autotuner"><i class="fa fa-check"></i><b>3.1.6</b> Automating the Tuning</a></li>
<li class="chapter" data-level="3.1.7" data-path="tuning.html"><a href="tuning.html#summary"><i class="fa fa-check"></i><b>3.1.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="fs.html"><a href="fs.html"><i class="fa fa-check"></i><b>3.2</b> Feature Selection / Filtering</a><ul>
<li class="chapter" data-level="3.2.1" data-path="fs.html"><a href="fs.html#fs-filter"><i class="fa fa-check"></i><b>3.2.1</b> Filters</a><ul>
<li class="chapter" data-level="3.2.1.1" data-path="fs.html"><a href="fs.html#fs-calc"><i class="fa fa-check"></i><b>3.2.1.1</b> Calculating filter values</a></li>
<li class="chapter" data-level="3.2.1.2" data-path="fs.html"><a href="fs.html#fs-comb"><i class="fa fa-check"></i><b>3.2.1.2</b> Combining filter values</a></li>
<li class="chapter" data-level="3.2.1.3" data-path="fs.html"><a href="fs.html#filter-subset"><i class="fa fa-check"></i><b>3.2.1.3</b> Selecting a feature subset</a></li>
<li class="chapter" data-level="3.2.1.4" data-path="fs.html"><a href="fs.html#filter-construction"><i class="fa fa-check"></i><b>3.2.1.4</b> Custom construction of filters</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="fs.html"><a href="fs.html#fs-wrapper"><i class="fa fa-check"></i><b>3.2.2</b> Wrapper Methods</a></li>
<li class="chapter" data-level="3.2.3" data-path="fs.html"><a href="fs.html#fs-embedded"><i class="fa fa-check"></i><b>3.2.3</b> Embedded Methods</a></li>
<li class="chapter" data-level="3.2.4" data-path="fs.html"><a href="fs.html#fs-ensemble"><i class="fa fa-check"></i><b>3.2.4</b> Ensemble Methods</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="nested-resampling.html"><a href="nested-resampling.html"><i class="fa fa-check"></i><b>3.3</b> Nested Resampling</a><ul>
<li class="chapter" data-level="3.3.1" data-path="nested-resampling.html"><a href="nested-resampling.html#introduction-1"><i class="fa fa-check"></i><b>3.3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.3.2" data-path="nested-resampling.html"><a href="nested-resampling.html#execution"><i class="fa fa-check"></i><b>3.3.2</b> Execution</a></li>
<li class="chapter" data-level="3.3.3" data-path="nested-resampling.html"><a href="nested-resampling.html#rr-eval"><i class="fa fa-check"></i><b>3.3.3</b> Evaluation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipelines.html"><a href="pipelines.html"><i class="fa fa-check"></i><b>4</b> Pipelines</a><ul>
<li class="chapter" data-level="4.1" data-path="the-building-blocks-pipeops.html"><a href="the-building-blocks-pipeops.html"><i class="fa fa-check"></i><b>4.1</b> The Building Blocks: PipeOps</a></li>
<li class="chapter" data-level="4.2" data-path="pipe-operator.html"><a href="pipe-operator.html"><i class="fa fa-check"></i><b>4.2</b> The Pipeline Operator: <code>%&gt;&gt;%</code></a></li>
<li class="chapter" data-level="4.3" data-path="pipe-nodes-edges-graphs.html"><a href="pipe-nodes-edges-graphs.html"><i class="fa fa-check"></i><b>4.3</b> Nodes, Edges and Graphs</a></li>
<li class="chapter" data-level="4.4" data-path="pipe-modeling.html"><a href="pipe-modeling.html"><i class="fa fa-check"></i><b>4.4</b> Modeling</a><ul>
<li class="chapter" data-level="4.4.1" data-path="pipe-modeling.html"><a href="pipe-modeling.html#pipe-hyperpars"><i class="fa fa-check"></i><b>4.4.1</b> Setting Hyperparameters</a></li>
<li class="chapter" data-level="4.4.2" data-path="pipe-modeling.html"><a href="pipe-modeling.html#pipe-tuning"><i class="fa fa-check"></i><b>4.4.2</b> Tuning</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html"><i class="fa fa-check"></i><b>4.5</b> Non-Linear Graphs</a><ul>
<li class="chapter" data-level="4.5.1" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles-branching-copying"><i class="fa fa-check"></i><b>4.5.1</b> Branching &amp; Copying</a></li>
<li class="chapter" data-level="4.5.2" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles"><i class="fa fa-check"></i><b>4.5.2</b> Model Ensembles</a><ul>
<li class="chapter" data-level="4.5.2.1" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles-bagging"><i class="fa fa-check"></i><b>4.5.2.1</b> Bagging</a></li>
<li class="chapter" data-level="4.5.2.2" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#pipe-model-ensembles-stacking"><i class="fa fa-check"></i><b>4.5.2.2</b> Stacking</a></li>
<li class="chapter" data-level="4.5.2.3" data-path="pipe-nonlinear.html"><a href="pipe-nonlinear.html#multilevel-stacking"><i class="fa fa-check"></i><b>4.5.2.3</b> Multilevel Stacking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html"><i class="fa fa-check"></i><b>4.6</b> Special Operators</a><ul>
<li class="chapter" data-level="4.6.1" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#imputation-pipeopimpute"><i class="fa fa-check"></i><b>4.6.1</b> Imputation: <span><code>PipeOpImpute</code></span></a></li>
<li class="chapter" data-level="4.6.2" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#feature-engineering-pipeopmutate"><i class="fa fa-check"></i><b>4.6.2</b> Feature Engineering: <span><code>PipeOpMutate</code></span></a></li>
<li class="chapter" data-level="4.6.3" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#training-on-data-subsets-pipeopchunk"><i class="fa fa-check"></i><b>4.6.3</b> Training on data subsets: <span><code>PipeOpChunk</code></span></a></li>
<li class="chapter" data-level="4.6.4" data-path="pipe-special-ops.html"><a href="pipe-special-ops.html#feature-selection-pipeopfilter-pipeopselect"><i class="fa fa-check"></i><b>4.6.4</b> Feature Selection: <span><code>PipeOpFilter</code></span> , <span><code>PipeOpSelect</code></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="technical.html"><a href="technical.html"><i class="fa fa-check"></i><b>5</b> Technical</a><ul>
<li class="chapter" data-level="5.1" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>5.1</b> Parallelization</a></li>
<li class="chapter" data-level="5.2" data-path="error-handling.html"><a href="error-handling.html"><i class="fa fa-check"></i><b>5.2</b> Error Handling</a><ul>
<li class="chapter" data-level="5.2.1" data-path="error-handling.html"><a href="error-handling.html#encapsulation"><i class="fa fa-check"></i><b>5.2.1</b> Encapsulation</a></li>
<li class="chapter" data-level="5.2.2" data-path="error-handling.html"><a href="error-handling.html#fallback-learners"><i class="fa fa-check"></i><b>5.2.2</b> Fallback learners</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="backends.html"><a href="backends.html"><i class="fa fa-check"></i><b>5.3</b> Database Backends</a><ul>
<li class="chapter" data-level="5.3.1" data-path="backends.html"><a href="backends.html#example-data"><i class="fa fa-check"></i><b>5.3.1</b> Example Data</a></li>
<li class="chapter" data-level="5.3.2" data-path="backends.html"><a href="backends.html#preprocessing-with-dplyr"><i class="fa fa-check"></i><b>5.3.2</b> Preprocessing with <code>dplyr</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="backends.html"><a href="backends.html#databackenddplyr"><i class="fa fa-check"></i><b>5.3.3</b> DataBackendDplyr</a></li>
<li class="chapter" data-level="5.3.4" data-path="backends.html"><a href="backends.html#model-fitting"><i class="fa fa-check"></i><b>5.3.4</b> Model fitting</a></li>
<li class="chapter" data-level="5.3.5" data-path="backends.html"><a href="backends.html#cleanup"><i class="fa fa-check"></i><b>5.3.5</b> Cleanup</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="paradox.html"><a href="paradox.html"><i class="fa fa-check"></i><b>5.4</b> Parameters (using <code>paradox</code>)</a><ul>
<li class="chapter" data-level="5.4.1" data-path="paradox.html"><a href="paradox.html#reference-based-objects"><i class="fa fa-check"></i><b>5.4.1</b> Reference Based Objects</a></li>
<li class="chapter" data-level="5.4.2" data-path="paradox.html"><a href="paradox.html#defining-a-parameter-space"><i class="fa fa-check"></i><b>5.4.2</b> Defining a Parameter Space</a><ul>
<li class="chapter" data-level="5.4.2.1" data-path="paradox.html"><a href="paradox.html#single-parameters"><i class="fa fa-check"></i><b>5.4.2.1</b> Single Parameters</a></li>
<li class="chapter" data-level="5.4.2.2" data-path="paradox.html"><a href="paradox.html#parameter-sets"><i class="fa fa-check"></i><b>5.4.2.2</b> Parameter Sets</a></li>
<li class="chapter" data-level="5.4.2.3" data-path="paradox.html"><a href="paradox.html#vector-parameters"><i class="fa fa-check"></i><b>5.4.2.3</b> Vector Parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.4.3" data-path="paradox.html"><a href="paradox.html#parameter-sampling"><i class="fa fa-check"></i><b>5.4.3</b> Parameter Sampling</a><ul>
<li class="chapter" data-level="5.4.3.1" data-path="paradox.html"><a href="paradox.html#parameter-designs"><i class="fa fa-check"></i><b>5.4.3.1</b> Parameter Designs</a></li>
<li class="chapter" data-level="5.4.3.2" data-path="paradox.html"><a href="paradox.html#grid-design"><i class="fa fa-check"></i><b>5.4.3.2</b> Grid Design</a></li>
<li class="chapter" data-level="5.4.3.3" data-path="paradox.html"><a href="paradox.html#random-sampling"><i class="fa fa-check"></i><b>5.4.3.3</b> Random Sampling</a></li>
<li class="chapter" data-level="5.4.3.4" data-path="paradox.html"><a href="paradox.html#generalized-sampling-the-sampler-class"><i class="fa fa-check"></i><b>5.4.3.4</b> Generalized Sampling: The <code>Sampler</code> Class</a></li>
</ul></li>
<li class="chapter" data-level="5.4.4" data-path="paradox.html"><a href="paradox.html#parameter-transformation"><i class="fa fa-check"></i><b>5.4.4</b> Parameter Transformation</a><ul>
<li class="chapter" data-level="5.4.4.1" data-path="paradox.html"><a href="paradox.html#transformation-between-types"><i class="fa fa-check"></i><b>5.4.4.1</b> Transformation between Types</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="extending.html"><a href="extending.html"><i class="fa fa-check"></i><b>5.5</b> Extending mlr3</a><ul>
<li class="chapter" data-level="5.5.1" data-path="extending.html"><a href="extending.html#ext-learner"><i class="fa fa-check"></i><b>5.5.1</b> Learners</a><ul>
<li class="chapter" data-level="5.5.1.1" data-path="extending.html"><a href="extending.html#learner-meta-information"><i class="fa fa-check"></i><b>5.5.1.1</b> Meta-information</a></li>
<li class="chapter" data-level="5.5.1.2" data-path="extending.html"><a href="extending.html#learner-train"><i class="fa fa-check"></i><b>5.5.1.2</b> Train function</a></li>
<li class="chapter" data-level="5.5.1.3" data-path="extending.html"><a href="extending.html#learner-predict"><i class="fa fa-check"></i><b>5.5.1.3</b> Predict function</a></li>
<li class="chapter" data-level="5.5.1.4" data-path="extending.html"><a href="extending.html#final-learner"><i class="fa fa-check"></i><b>5.5.1.4</b> Final learner</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="extending-pipes.html"><a href="extending-pipes.html"><i class="fa fa-check"></i><b>5.6</b> Extending mlr3pipelines</a><ul>
<li class="chapter" data-level="5.6.1" data-path="extending-pipes.html"><a href="extending-pipes.html#general-case-example-pipeopcopy"><i class="fa fa-check"></i><b>5.6.1</b> General Case Example: <code>PipeOpCopy</code></a><ul>
<li class="chapter" data-level="5.6.1.1" data-path="extending-pipes.html"><a href="extending-pipes.html#first-steps-inheriting-from-pipeop"><i class="fa fa-check"></i><b>5.6.1.1</b> First Steps: Inheriting from <code>PipeOp</code></a></li>
<li class="chapter" data-level="5.6.1.2" data-path="extending-pipes.html"><a href="extending-pipes.html#channel-definitions"><i class="fa fa-check"></i><b>5.6.1.2</b> Channel Definitions</a></li>
<li class="chapter" data-level="5.6.1.3" data-path="extending-pipes.html"><a href="extending-pipes.html#train-and-predict"><i class="fa fa-check"></i><b>5.6.1.3</b> Train and Predict</a></li>
<li class="chapter" data-level="5.6.1.4" data-path="extending-pipes.html"><a href="extending-pipes.html#putting-it-together"><i class="fa fa-check"></i><b>5.6.1.4</b> Putting it Together</a></li>
</ul></li>
<li class="chapter" data-level="5.6.2" data-path="extending-pipes.html"><a href="extending-pipes.html#special-case-preprocessing"><i class="fa fa-check"></i><b>5.6.2</b> Special Case: Preprocessing</a><ul>
<li class="chapter" data-level="5.6.2.1" data-path="extending-pipes.html"><a href="extending-pipes.html#example-pipeopdropna"><i class="fa fa-check"></i><b>5.6.2.1</b> Example: <code>PipeOpDropNA</code></a></li>
<li class="chapter" data-level="5.6.2.2" data-path="extending-pipes.html"><a href="extending-pipes.html#example-pipeopscalealways"><i class="fa fa-check"></i><b>5.6.2.2</b> Example: <code>PipeOpScaleAlways</code></a></li>
</ul></li>
<li class="chapter" data-level="5.6.3" data-path="extending-pipes.html"><a href="extending-pipes.html#special-case-preprocessing-with-simple-train"><i class="fa fa-check"></i><b>5.6.3</b> Special Case: Preprocessing with Simple Train</a><ul>
<li class="chapter" data-level="5.6.3.1" data-path="extending-pipes.html"><a href="extending-pipes.html#example-pipeopdropconst"><i class="fa fa-check"></i><b>5.6.3.1</b> Example: <code>PipeOpDropConst</code></a></li>
<li class="chapter" data-level="5.6.3.2" data-path="extending-pipes.html"><a href="extending-pipes.html#example-pipeopscalealwayssimple"><i class="fa fa-check"></i><b>5.6.3.2</b> Example: <code>PipeOpScaleAlwaysSimple</code></a></li>
</ul></li>
<li class="chapter" data-level="5.6.4" data-path="extending-pipes.html"><a href="extending-pipes.html#hyperparameters"><i class="fa fa-check"></i><b>5.6.4</b> Hyperparameters</a><ul>
<li class="chapter" data-level="5.6.4.1" data-path="extending-pipes.html"><a href="extending-pipes.html#hyperparameter-example-pipeopscale"><i class="fa fa-check"></i><b>5.6.4.1</b> Hyperparameter Example: <code>PipeOpScale</code></a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="special-tasks.html"><a href="special-tasks.html"><i class="fa fa-check"></i><b>6</b> Special Tasks</a><ul>
<li class="chapter" data-level="6.1" data-path="survival.html"><a href="survival.html"><i class="fa fa-check"></i><b>6.1</b> Survival Analysis</a></li>
<li class="chapter" data-level="6.2" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i><b>6.2</b> Ordinal Analysis</a></li>
<li class="chapter" data-level="6.3" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>6.3</b> Spatial Analysis</a></li>
<li class="chapter" data-level="6.4" data-path="functional.html"><a href="functional.html"><i class="fa fa-check"></i><b>6.4</b> Functional Analysis</a></li>
<li class="chapter" data-level="6.5" data-path="multilabel.html"><a href="multilabel.html"><i class="fa fa-check"></i><b>6.5</b> Multilabel Analysis</a></li>
<li class="chapter" data-level="6.6" data-path="cost-sens.html"><a href="cost-sens.html"><i class="fa fa-check"></i><b>6.6</b> Cost-Sensitive Classification</a><ul>
<li class="chapter" data-level="6.6.1" data-path="cost-sens.html"><a href="cost-sens.html#a-first-model"><i class="fa fa-check"></i><b>6.6.1</b> A First Model</a></li>
<li class="chapter" data-level="6.6.2" data-path="cost-sens.html"><a href="cost-sens.html#cost-sensitive-measure"><i class="fa fa-check"></i><b>6.6.2</b> Cost-sensitive Measure</a></li>
<li class="chapter" data-level="6.6.3" data-path="cost-sens.html"><a href="cost-sens.html#thresholding"><i class="fa fa-check"></i><b>6.6.3</b> Thresholding</a></li>
<li class="chapter" data-level="6.6.4" data-path="cost-sens.html"><a href="cost-sens.html#threshold-tuning"><i class="fa fa-check"></i><b>6.6.4</b> Threshold Tuning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-interpr.html"><a href="model-interpr.html"><i class="fa fa-check"></i><b>7</b> Model Interpretation with mlr3</a><ul>
<li class="chapter" data-level="7.1" data-path="iml.html"><a href="iml.html"><i class="fa fa-check"></i><b>7.1</b> IML</a></li>
<li class="chapter" data-level="7.2" data-path="dalex.html"><a href="dalex.html"><i class="fa fa-check"></i><b>7.2</b> Dalex</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="use-cases.html"><a href="use-cases.html"><i class="fa fa-check"></i><b>8</b> Use Cases</a></li>
<li class="chapter" data-level="9" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>9</b> Appendix</a><ul>
<li class="chapter" data-level="9.1" data-path="list-learners.html"><a href="list-learners.html"><i class="fa fa-check"></i><b>9.1</b> Integrated Learners</a></li>
<li class="chapter" data-level="9.2" data-path="list-filters.html"><a href="list-filters.html"><i class="fa fa-check"></i><b>9.2</b> Integrated Filter Methods</a><ul>
<li class="chapter" data-level="9.2.1" data-path="list-filters.html"><a href="list-filters.html#fs-filter-list"><i class="fa fa-check"></i><b>9.2.1</b> Standalone filter methods</a></li>
<li class="chapter" data-level="9.2.2" data-path="list-filters.html"><a href="list-filters.html#fs-filter-embedded-list"><i class="fa fa-check"></i><b>9.2.2</b> Algorithms With Embedded Filter Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">mlr3 manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cost-sens" class="section level2">
<h2><span class="header-section-number">6.6</span> Cost-Sensitive Classification</h2>
<p>Imagine you are an analyst for a big credit institution.
Let’s also assume that a correct decision of the bank would result in 35% of the profit at the end of a specific period.
A correct decision means that the bank predicts that a customer will pay their bills (hence would obtain a loan), and the customer indeed has good credit.
On the other hand, a wrong decision means that the bank predicts that the customer’s credit is in good standing, but the opposite is true.
This would result in a loss of 100% of the given loan.</p>
<table>
<thead>
<tr class="header">
<th align="center"></th>
<th align="center">Good Customer (truth)</th>
<th align="center">Bad Customer (truth)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Good Customer (predicted)</td>
<td align="center">+ 0.35</td>
<td align="center">- 1.0</td>
</tr>
<tr class="even">
<td align="center">Bad Customer (predicted)</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>Expressed as costs (instead of profit), we can write down the cost-matrix as follows:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">costs =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">0.35</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb226-2" title="2"><span class="kw">dimnames</span>(costs) =<span class="st"> </span><span class="kw">list</span>(<span class="dt">response =</span> <span class="kw">c</span>(<span class="st">&quot;good&quot;</span>, <span class="st">&quot;bad&quot;</span>), <span class="dt">truth =</span> <span class="kw">c</span>(<span class="st">&quot;good&quot;</span>, <span class="st">&quot;bad&quot;</span>))</a>
<a class="sourceLine" id="cb226-3" title="3"><span class="kw">print</span>(costs)</a>
<a class="sourceLine" id="cb226-4" title="4"><span class="co">#&gt;         truth</span></a>
<a class="sourceLine" id="cb226-5" title="5"><span class="co">#&gt; response  good bad</span></a>
<a class="sourceLine" id="cb226-6" title="6"><span class="co">#&gt;     good -0.35   1</span></a>
<a class="sourceLine" id="cb226-7" title="7"><span class="co">#&gt;     bad   0.00   0</span></a></code></pre></div>
<p>An exemplary data set for such a problem is the <a href="https://mlr3.mlr-org.com/reference/mlr_tasks_german_credit.html"><code>German Credit</code></a> task:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" title="1"><span class="kw">library</span>(mlr3)</a>
<a class="sourceLine" id="cb227-2" title="2">task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;german_credit&quot;</span>)</a>
<a class="sourceLine" id="cb227-3" title="3"><span class="kw">table</span>(task<span class="op">$</span><span class="kw">truth</span>())</a>
<a class="sourceLine" id="cb227-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb227-5" title="5"><span class="co">#&gt; good  bad </span></a>
<a class="sourceLine" id="cb227-6" title="6"><span class="co">#&gt;  700  300</span></a></code></pre></div>
<p>The data has 70% customers who are able to pay back their credit, and 30% bad customers who default on the debt.
A manager, who doesn’t have any model, could decide to give either everybody a credit or to give nobody a credit.
The resulting costs for the German credit data are:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1"><span class="co"># nobody:</span></a>
<a class="sourceLine" id="cb228-2" title="2">(<span class="dv">700</span> <span class="op">*</span><span class="st"> </span>costs[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">300</span> <span class="op">*</span><span class="st"> </span>costs[<span class="dv">2</span>, <span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb228-3" title="3"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb228-4" title="4"></a>
<a class="sourceLine" id="cb228-5" title="5"><span class="co"># everybody</span></a>
<a class="sourceLine" id="cb228-6" title="6">(<span class="dv">700</span> <span class="op">*</span><span class="st"> </span>costs[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">300</span> <span class="op">*</span><span class="st"> </span>costs[<span class="dv">1</span>, <span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb228-7" title="7"><span class="co">#&gt; [1] 0.055</span></a></code></pre></div>
<p>If the average loan is $20,000, the credit institute would lose more than one million dollar if it would grant everybody a credit:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" title="1"><span class="co"># average profit * average loan * number of customers</span></a>
<a class="sourceLine" id="cb229-2" title="2"><span class="fl">0.055</span> <span class="op">*</span><span class="st"> </span><span class="dv">20000</span> <span class="op">*</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb229-3" title="3"><span class="co">#&gt; [1] 1100000</span></a></code></pre></div>
<p>Our goal is to find a model which minimizes the costs (and thereby maximizes the expected profit).</p>
<div id="a-first-model" class="section level3">
<h3><span class="header-section-number">6.6.1</span> A First Model</h3>
<p>For our first model, we choose an ordinary logistic regression (implemented in the add-on package <a href="https://mlr3learners.mlr-org.com">mlr3learners</a>).
We first create a classification task, then resample the model using a 10-fold cross validation and extract the resulting confusion matrix:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1"><span class="kw">library</span>(mlr3learners)</a>
<a class="sourceLine" id="cb230-2" title="2">learner =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;classif.log_reg&quot;</span>)</a>
<a class="sourceLine" id="cb230-3" title="3">rr =<span class="st"> </span><span class="kw">resample</span>(task, learner, <span class="st">&quot;cv&quot;</span>)</a>
<a class="sourceLine" id="cb230-4" title="4"></a>
<a class="sourceLine" id="cb230-5" title="5">confusion =<span class="st"> </span>rr<span class="op">$</span>prediction<span class="op">$</span>confusion</a>
<a class="sourceLine" id="cb230-6" title="6"><span class="kw">print</span>(confusion)</a>
<a class="sourceLine" id="cb230-7" title="7"><span class="co">#&gt;         truth</span></a>
<a class="sourceLine" id="cb230-8" title="8"><span class="co">#&gt; response good bad</span></a>
<a class="sourceLine" id="cb230-9" title="9"><span class="co">#&gt;     good  607 156</span></a>
<a class="sourceLine" id="cb230-10" title="10"><span class="co">#&gt;     bad    93 144</span></a></code></pre></div>
<p>To calculate the average costs like above, we can simply multiply the elements of the confusion matrix with the elements of the previously introduced cost matrix, and sum the values of the resulting matrix:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" title="1">avg_costs =<span class="st"> </span><span class="kw">sum</span>(confusion <span class="op">*</span><span class="st"> </span>costs) <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb231-2" title="2"><span class="kw">print</span>(avg_costs)</a>
<a class="sourceLine" id="cb231-3" title="3"><span class="co">#&gt; [1] -0.05645</span></a></code></pre></div>
<p>With an average loan of $20,000, the logistic regression yields the following costs:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1">avg_costs <span class="op">*</span><span class="st"> </span><span class="dv">20000</span> <span class="op">*</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb232-2" title="2"><span class="co">#&gt; [1] -1129000</span></a></code></pre></div>
<p>Instead of losing over $1,000,000, the credit institute now can expect a profit of more than $1,000,000.</p>
</div>
<div id="cost-sensitive-measure" class="section level3">
<h3><span class="header-section-number">6.6.2</span> Cost-sensitive Measure</h3>
<p>Our natural next step would be to further improve the modeling step in order to maximize the profit.
For this purpose we first create a cost-sensitive classification measure which calculates the costs based on our cost matrix.
This allows us to conveniently quantify and compare modeling decisions.
Fortunately, there already is a predefined measure <a href="https://mlr3.mlr-org.com/reference/Measure.html"><code>Measure</code></a> for this purpose: <a href="https://mlr3.mlr-org.com/reference/MeasureClassifCosts.html"><code>MeasureClassifCosts</code></a>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1">cost_measure =<span class="st"> </span>MeasureClassifCosts<span class="op">$</span><span class="kw">new</span>(<span class="st">&quot;credit_costs&quot;</span>, costs)</a>
<a class="sourceLine" id="cb233-2" title="2"><span class="kw">print</span>(cost_measure)</a>
<a class="sourceLine" id="cb233-3" title="3"><span class="co">#&gt; &lt;MeasureClassifCosts:credit_costs&gt;</span></a>
<a class="sourceLine" id="cb233-4" title="4"><span class="co">#&gt; Packages: -</span></a>
<a class="sourceLine" id="cb233-5" title="5"><span class="co">#&gt; Range: [-Inf, Inf]</span></a>
<a class="sourceLine" id="cb233-6" title="6"><span class="co">#&gt; Minimize: TRUE</span></a>
<a class="sourceLine" id="cb233-7" title="7"><span class="co">#&gt; Properties: requires_task</span></a>
<a class="sourceLine" id="cb233-8" title="8"><span class="co">#&gt; Predict type: response</span></a></code></pre></div>
<p>If we now call <a href="https://mlr3.mlr-org.com/reference/resample.html"><code>resample()</code></a> or <a href="https://mlr3.mlr-org.com/reference/benchmark.html"><code>benchmark()</code></a>, the cost-sensitive measures will be evaluated.
We compare the logistic regression to a simple featureless learner and to a random forest from package <a href="https://cran.r-project.org/package=ranger">ranger</a> :</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1">learners =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw">mget</span>(<span class="kw">c</span>(<span class="st">&quot;classif.log_reg&quot;</span>, <span class="st">&quot;classif.featureless&quot;</span>, <span class="st">&quot;classif.ranger&quot;</span>))</a>
<a class="sourceLine" id="cb234-2" title="2">bmr =<span class="st"> </span><span class="kw">benchmark</span>(<span class="kw">expand_grid</span>(task, learners, <span class="st">&quot;cv&quot;</span>))</a>
<a class="sourceLine" id="cb234-3" title="3">bmr<span class="op">$</span><span class="kw">aggregate</span>(cost_measure)</a>
<a class="sourceLine" id="cb234-4" title="4"><span class="co">#&gt;                hash  resample_result       task_id          learner_id</span></a>
<a class="sourceLine" id="cb234-5" title="5"><span class="co">#&gt; 1: d2889368a18c076d &lt;ResampleResult&gt; german_credit     classif.log_reg</span></a>
<a class="sourceLine" id="cb234-6" title="6"><span class="co">#&gt; 2: 7eb031e3741ce663 &lt;ResampleResult&gt; german_credit classif.featureless</span></a>
<a class="sourceLine" id="cb234-7" title="7"><span class="co">#&gt; 3: 06ffe67495186afa &lt;ResampleResult&gt; german_credit      classif.ranger</span></a>
<a class="sourceLine" id="cb234-8" title="8"><span class="co">#&gt;    resampling_id credit_costs</span></a>
<a class="sourceLine" id="cb234-9" title="9"><span class="co">#&gt; 1:            cv     -0.05665</span></a>
<a class="sourceLine" id="cb234-10" title="10"><span class="co">#&gt; 2:            cv      0.05500</span></a>
<a class="sourceLine" id="cb234-11" title="11"><span class="co">#&gt; 3:            cv     -0.04865</span></a></code></pre></div>
<p>As expected, the featureless learner is performing comparably bad.
The logistic regression and the random forest work equally well.</p>
</div>
<div id="thresholding" class="section level3">
<h3><span class="header-section-number">6.6.3</span> Thresholding</h3>
<p>Although we now correctly evaluate the models in a cost-sensitive fashion, the models themselves are unaware of the classification costs.
They assume the same costs for both wrong classification decisions (false positives and false negatives).
Some learners natively support cost-sensitive classification (e.g., XXX).
However, we will concentrate on a more generic approach which works for all models which can predict probabilities for class labels: thresholding.</p>
<p>Most learners can calculate the probability <span class="math inline">\(p\)</span> for the positive class.
If <span class="math inline">\(p\)</span> exceeds the threshold <span class="math inline">\(0.5\)</span>, they predict the positive class, and the negative class otherwise.</p>
<p>For our binary classification case of the credit data, the we primarily want to minimize the errors where the model predicts “good”, but truth is “bad” (i.e., the number of false positives) as this is the more expensive error.
If we now increase the threshold to values <span class="math inline">\(&gt; 0.5\)</span>, we reduce the number of false negatives.
Note that we increase the number of false positives simultaneously, or, in other words, we are trading false positives for false negatives.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1"><span class="co"># fit models with probability prediction</span></a>
<a class="sourceLine" id="cb235-2" title="2">learner =<span class="st"> </span>mlr_learners<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;classif.log_reg&quot;</span>, <span class="dt">predict_type =</span> <span class="st">&quot;prob&quot;</span>)</a>
<a class="sourceLine" id="cb235-3" title="3">rr =<span class="st"> </span><span class="kw">resample</span>(task, learner, <span class="st">&quot;cv&quot;</span>)</a>
<a class="sourceLine" id="cb235-4" title="4">p =<span class="st"> </span>rr<span class="op">$</span>prediction</a>
<a class="sourceLine" id="cb235-5" title="5"><span class="kw">print</span>(p)</a>
<a class="sourceLine" id="cb235-6" title="6"><span class="co">#&gt; &lt;PredictionClassif&gt; for 1000 observations:</span></a>
<a class="sourceLine" id="cb235-7" title="7"><span class="co">#&gt;       row_id truth response prob.good prob.bad</span></a>
<a class="sourceLine" id="cb235-8" title="8"><span class="co">#&gt;    1:      7  good     good    0.9364  0.06356</span></a>
<a class="sourceLine" id="cb235-9" title="9"><span class="co">#&gt;    2:     12   bad      bad    0.1563  0.84369</span></a>
<a class="sourceLine" id="cb235-10" title="10"><span class="co">#&gt;    3:     43  good     good    0.6406  0.35944</span></a>
<a class="sourceLine" id="cb235-11" title="11"><span class="co">#&gt;   ---                                         </span></a>
<a class="sourceLine" id="cb235-12" title="12"><span class="co">#&gt;  998:    963  good     good    0.8204  0.17963</span></a>
<a class="sourceLine" id="cb235-13" title="13"><span class="co">#&gt;  999:    976  good     good    0.9167  0.08334</span></a>
<a class="sourceLine" id="cb235-14" title="14"><span class="co">#&gt; 1000:    993  good     good    0.8080  0.19201</span></a>
<a class="sourceLine" id="cb235-15" title="15"></a>
<a class="sourceLine" id="cb235-16" title="16"><span class="co"># helper function to try different threshold values interactively</span></a>
<a class="sourceLine" id="cb235-17" title="17">with_threshold =<span class="st"> </span><span class="cf">function</span>(p, th) {</a>
<a class="sourceLine" id="cb235-18" title="18">  p<span class="op">$</span><span class="kw">set_threshold</span>(th)</a>
<a class="sourceLine" id="cb235-19" title="19">  <span class="kw">list</span>(<span class="dt">confusion =</span> p<span class="op">$</span>confusion, <span class="dt">costs =</span> p<span class="op">$</span><span class="kw">score</span>(<span class="dt">measures =</span> cost_measure, <span class="dt">task =</span> task))</a>
<a class="sourceLine" id="cb235-20" title="20">}</a>
<a class="sourceLine" id="cb235-21" title="21"></a>
<a class="sourceLine" id="cb235-22" title="22"><span class="kw">with_threshold</span>(p, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb235-23" title="23"><span class="co">#&gt; $confusion</span></a>
<a class="sourceLine" id="cb235-24" title="24"><span class="co">#&gt;         truth</span></a>
<a class="sourceLine" id="cb235-25" title="25"><span class="co">#&gt; response good bad</span></a>
<a class="sourceLine" id="cb235-26" title="26"><span class="co">#&gt;     good  603 159</span></a>
<a class="sourceLine" id="cb235-27" title="27"><span class="co">#&gt;     bad    97 141</span></a>
<a class="sourceLine" id="cb235-28" title="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb235-29" title="29"><span class="co">#&gt; $costs</span></a>
<a class="sourceLine" id="cb235-30" title="30"><span class="co">#&gt; credit_costs </span></a>
<a class="sourceLine" id="cb235-31" title="31"><span class="co">#&gt;     -0.05205</span></a>
<a class="sourceLine" id="cb235-32" title="32"><span class="kw">with_threshold</span>(p, <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb235-33" title="33"><span class="co">#&gt; $confusion</span></a>
<a class="sourceLine" id="cb235-34" title="34"><span class="co">#&gt;         truth</span></a>
<a class="sourceLine" id="cb235-35" title="35"><span class="co">#&gt; response good bad</span></a>
<a class="sourceLine" id="cb235-36" title="36"><span class="co">#&gt;     good  471  72</span></a>
<a class="sourceLine" id="cb235-37" title="37"><span class="co">#&gt;     bad   229 228</span></a>
<a class="sourceLine" id="cb235-38" title="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb235-39" title="39"><span class="co">#&gt; $costs</span></a>
<a class="sourceLine" id="cb235-40" title="40"><span class="co">#&gt; credit_costs </span></a>
<a class="sourceLine" id="cb235-41" title="41"><span class="co">#&gt;     -0.09285</span></a>
<a class="sourceLine" id="cb235-42" title="42"><span class="kw">with_threshold</span>(p, <span class="fl">1.0</span>)</a>
<a class="sourceLine" id="cb235-43" title="43"><span class="co">#&gt; $confusion</span></a>
<a class="sourceLine" id="cb235-44" title="44"><span class="co">#&gt;         truth</span></a>
<a class="sourceLine" id="cb235-45" title="45"><span class="co">#&gt; response good bad</span></a>
<a class="sourceLine" id="cb235-46" title="46"><span class="co">#&gt;     good    1   1</span></a>
<a class="sourceLine" id="cb235-47" title="47"><span class="co">#&gt;     bad   699 299</span></a>
<a class="sourceLine" id="cb235-48" title="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb235-49" title="49"><span class="co">#&gt; $costs</span></a>
<a class="sourceLine" id="cb235-50" title="50"><span class="co">#&gt; credit_costs </span></a>
<a class="sourceLine" id="cb235-51" title="51"><span class="co">#&gt;      0.00065</span></a>
<a class="sourceLine" id="cb235-52" title="52"></a>
<a class="sourceLine" id="cb235-53" title="53"><span class="co"># </span><span class="al">TODO</span><span class="co">: include plot of threshold vs performance</span></a></code></pre></div>
<p>Instead of manually trying different threshold values, we here use <a href="https://www.rdocumentation.org/packages/stats/topics/optimize"><code>optimize()</code></a> to find a good threshold value w.r.t. our performance measure:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1"><span class="co"># simple wrapper function which takes a threshold and returns the resulting model performance</span></a>
<a class="sourceLine" id="cb236-2" title="2"><span class="co"># this wrapper is passed to optimize() to find its minimum for thresholds in [0.5, 1]</span></a>
<a class="sourceLine" id="cb236-3" title="3">f =<span class="st"> </span><span class="cf">function</span>(th) {</a>
<a class="sourceLine" id="cb236-4" title="4">  <span class="kw">with_threshold</span>(p, th)<span class="op">$</span>costs</a>
<a class="sourceLine" id="cb236-5" title="5">}</a>
<a class="sourceLine" id="cb236-6" title="6">best =<span class="st"> </span><span class="kw">optimize</span>(f, <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb236-7" title="7"><span class="kw">print</span>(best)</a>
<a class="sourceLine" id="cb236-8" title="8"><span class="co">#&gt; $minimum</span></a>
<a class="sourceLine" id="cb236-9" title="9"><span class="co">#&gt; [1] 0.7661</span></a>
<a class="sourceLine" id="cb236-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb236-11" title="11"><span class="co">#&gt; $objective</span></a>
<a class="sourceLine" id="cb236-12" title="12"><span class="co">#&gt; credit_costs </span></a>
<a class="sourceLine" id="cb236-13" title="13"><span class="co">#&gt;      -0.0956</span></a>
<a class="sourceLine" id="cb236-14" title="14"></a>
<a class="sourceLine" id="cb236-15" title="15"><span class="co"># optimized confusion matrix:</span></a>
<a class="sourceLine" id="cb236-16" title="16"><span class="kw">with_threshold</span>(p, best<span class="op">$</span>minimum)<span class="op">$</span>confusion</a>
<a class="sourceLine" id="cb236-17" title="17"><span class="co">#&gt;         truth</span></a>
<a class="sourceLine" id="cb236-18" title="18"><span class="co">#&gt; response good bad</span></a>
<a class="sourceLine" id="cb236-19" title="19"><span class="co">#&gt;     good  456  64</span></a>
<a class="sourceLine" id="cb236-20" title="20"><span class="co">#&gt;     bad   244 236</span></a></code></pre></div>
<div class="warning">
<p>
The function <code>optimize()</code> is intended for unimodal functions and therefore may converge to a local optimum here. See below for better alternatives to find good threshold values.
</p>
</div>
</div>
<div id="threshold-tuning" class="section level3">
<h3><span class="header-section-number">6.6.4</span> Threshold Tuning</h3>
<p>To be continued…</p>
<ul>
<li>threshold tuning as pipeline operator</li>
<li>joint hyperparameter optimization</li>
</ul>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="multilabel.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-interpr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mlr-org/mlr3book/edit/master/bookdown/05-special-tasks.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/mlr-org/mlr3book/commits/master/05-special-tasks.Rmd",
"text": "Eedit history"
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
